@using Microsoft.Extensions.Options
@using HRPackage.Models
@inject IOptions<CompanySettings> CompanySettings
@model PurchaseOrder
@{
    ViewData["Title"] = "Print PO - " + Model.PoNumber;
    Layout = null;
    var company = CompanySettings.Value;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { font-family: 'Arial', sans-serif; font-size: 13px; margin: 0; padding: 10px; }
        .po-box { border: 1px solid #000; max-width: 210mm; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }
        
        .layout-table { width: 100%; border-collapse: collapse; border-bottom: 1px solid #000; }
        .layout-table td { border-right: 1px solid #000; padding: 5px; vertical-align: top; }
        .layout-table td:last-child { border-right: none; }

        .items-container { flex-grow: 1; display: flex; flex-direction: column; }
        .items-table { width: 100%; border-collapse: collapse; }
        .items-table th { border-bottom: 1px solid #000; border-right: 1px solid #000; padding: 5px; text-align: center; }
        .items-table td { border-right: 1px solid #000; padding: 5px; vertical-align: top; }
        
        .items-spacer { flex-grow: 1; display: flex; width: 100%; }
        .items-spacer div { border-right: 1px solid #000; }
        .items-spacer div:last-child { border-right: none; }

        .terms-box { border-top: 1px solid #000; margin-top: auto; }
        .terms-table { width: 100%; border-collapse: collapse; }
        .terms-table td { border: 1px solid #000; padding: 3px; vertical-align: top; }
        
        @@media print {
            .no-print { display: none !important; }
            .po-box { height: 100%; border: 1px solid #000; }
            body { margin: 0; padding: 0; }
        }
    </style>
</head>
<body>
    <div class="print-btn-container no-print text-center mb-2">
        <button onclick="window.print()" class="btn btn-primary">Print</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Back</a>
    </div>

    <div class="po-box">
        <!-- Header -->
        <table class="layout-table">
            <tr>
                <td style="width: 30%; text-align: center;">
                     <img src="/images/logo.jpg" alt="LOGO" style="max-width: 80px;" onerror="this.style.display='none'"/>
                     <h2 class="m-0 text-primary">SIM</h2>
                </td>
                <td style="width: 40%; text-align: center; vertical-align: middle;">
                     <div style="font-size: 20px; font-weight: bold;">PURCHASE ORDER</div>
                </td>
                <td style="width: 30%;">
                     <div><strong>PO No:</strong> @Model.PoNumber</div>
                     <div><strong>Date:</strong> @Model.PoDate?.ToString("dd/MM/yyyy")</div>
                </td>
            </tr>
        </table>

        <!-- Address Info -->
        <table class="layout-table">
            <tr>
                <td style="width: 50%;">
                    <small>From :</small> <br/>
                    <strong>@company.Name.ToUpper()</strong><br/>
                    @company.AddressLine1<br/>
                    @company.AddressLine2<br/>
                    Email : @company.Email<br/>
                    GST NO : @company.GstNumber
                </td>
                <td>
                    <small>To :</small> <br/>
                    <strong>@(Model.Customer?.CustomerName ?? "Supplier")</strong><br/>
                    @(Model.Customer?.FullAddress ?? Model.SupplierName)<br/>
                    <strong>GST NO :</strong> @(Model.Customer?.GstNumber ?? "-")
                </td>
            </tr>
        </table>

        <!-- Items -->
        <div class="items-container">
            <table class="items-table">
                <thead>
                    <tr>
                        <th style="width: 10%;">Sl.no</th>
                        <th style="width: 50%;">Description</th>
                        <th style="width: 15%;">Unit price</th>
                        <th style="width: 10%;">Qty</th>
                        <th style="width: 15%; border-right: none;">Total Amt</th>
                    </tr>
                </thead>
                <tbody>
                    @{ int i = 1; }
                    @foreach(var item in Model.Items)
                    {
                        <tr>
                            <td class="text-center">@i</td>
                            <td>@item.ItemDescription</td>
                            <td class="text-end">@item.UnitPrice.ToString("N2")</td>
                            <td class="text-center">@item.Quantity</td>
                            <td class="text-end" style="border-right: none;">@item.LineTotal.ToString("N2")</td>
                        </tr>
                        i++;
                    }
                </tbody>
            </table>
            
            <!-- Spacer -->
            <div class="items-spacer">
                <div style="width: 10%;"></div>
                <div style="width: 50%;"></div>
                <div style="width: 15%;"></div>
                <div style="width: 10%;"></div>
                <div style="width: 15%; border-right: none;"></div>
            </div>
            
            <!-- Total -->
            <table style="width: 100%; border-top: 1px solid #000; border-collapse: collapse;">
                <tr>
                    <td style="width: 85%; border-right: 1px solid #000; padding: 5px; text-align: right; font-weight: bold;">Total</td>
                    <td style="width: 15%; padding: 5px; text-align: right; font-weight: bold;">@Model.PoAmount.ToString("N2")</td>
                </tr>
            </table>
        </div>

        <!-- Terms -->
        <div class="terms-box">
            <strong>Commercial Terms & Conditions</strong>
            <table class="terms-table">
                <tr>
                    <td style="width: 50px;">1</td>
                    <td style="width: 150px;">GST</td>
                    <td>18% Extra (As Applicable)</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Validity</td>
                    <td>This order is valid for 30 days.</td>
                </tr>
                 <tr>
                    <td>3</td>
                    <td>Payment</td>
                    <td>100% against Proforma Invoice</td>
                </tr>
            </table>
        </div>
    </div>
</body>
</html>
