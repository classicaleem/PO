@using Microsoft.Extensions.Options
@using HRPackage.Models
@inject IOptions<CompanySettings> CompanySettings
@model Quotation
@{
    Layout = null;
    var company = CompanySettings.Value;
    ViewData["Title"] = "Quote - " + Model.QuotationNo;
}

<!DOCTYPE html>
<html>
<head>
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { font-family: 'Arial', sans-serif; font-size: 13px; margin: 0; padding: 10px; }
        .quote-box { border: 1px solid #000; max-width: 210mm; margin: 0 auto; height: 100vh; display: flex; flex-direction: column; }
        
        /* ... existing styles ... */
        .items-header { display: flex; border-bottom: 1px solid #000; font-weight: bold; text-align: center; } /* Removing background color if user wanted clean look */
        
        .terms-table { width: 100%; border-collapse: collapse; }
        .terms-table td { vertical-align: top; padding: 2px; border: 1px solid #000; } /* Adding borders to terms table to match image */
        .terms-section strong { display: block; padding: 5px; border-bottom: 1px solid #000; }
        .terms-section { padding: 0; margin-top: auto; } /* Remove padding around section */

        @@media print {
            .no-print { display: none; }
            .quote-box { height: 100%; border: 1px solid #000; }
            body { margin: 0; padding: 0; }
        }
    </style>
</head>
<body>
    <div class="no-print text-center mb-2">
        <button onclick="window.print()" class="btn btn-primary">Print</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Back</a>
    </div>

    <div class="quote-box">
        <!-- Header -->
        <table style="width: 100%; border-bottom: 1px solid #000; border-collapse: collapse;">
            <tr>
                <td style="width: 30%; border-right: 1px solid #000; padding: 10px; text-align: center;">
                    <img src="/images/logo.jpg" style="max-width: 80px;" onerror="this.style.display='none'"/>
                    <h3 class="m-0 text-primary">SIM</h3>
                </td>
                <td style="width: 30%; border-right: 1px solid #000; text-align: center; vertical-align: middle;">
                    <span style="font-size: 24px; font-weight: bold;">Quotation</span>
                </td>
                <td style="width: 40%; padding: 5px; font-size: 12px; vertical-align: top;">
                    <div><strong>Quotation No:</strong> @Model.QuotationNo</div>
                    <div><strong>Quotation Date:</strong> @Model.Date.ToString("dd/MM/yyyy")</div>
                </td>
            </tr>
        </table>

        <!-- Address -->
        <table style="width: 100%; border-bottom: 1px solid #000; border-collapse: collapse;">
            <tr>
                <td style="width: 40%; border-right: 1px solid #000; padding: 5px; vertical-align: top; font-size: 12px;">
                    <strong>From : @company.Name.ToUpper()</strong> <br/>
                    @company.AddressLine1 <br/>
                    @company.AddressLine2 <br/>
                    Email : @company.Email | Ph: @company.Phone <br/>
                    <strong>GST NO : @company.GstNumber</strong>
                    <div><strong>Vendor Code : </strong> 208404</div>
                </td>
                <td style="width: 60%; padding: 5px; vertical-align: top; font-size: 12px;">
                    <strong>To : @(Model.Customer?.CustomerName ?? "Customer")</strong> <br/>
                    @(Model.Customer?.FullAddress ?? "") <br/>
                    <strong>GST NO : @(Model.Customer?.GstNumber ?? "-")</strong>
                </td>
            </tr>
        </table>
        
        <!-- Attn -->
        <table style="width: 100%; border-bottom: 1px solid #000; border-collapse: collapse;">
            <tr>
                <td style="width: 60%; padding: 5px; border-right: 1px solid #000;"><strong>Kind Attn.:</strong> -</td>
                <td style="width: 40%; padding: 5px;"><strong>Cell:</strong> -</td>
            </tr>
        </table>

        <!-- Items Container - Grows to fill space -->
        <div class="items-body" style="flex-grow: 1; display: flex; flex-direction: column;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 1px solid #000;">
                        <th style="width: 10%; border-right: 1px solid #000; padding: 5px; text-align: center;">Slno</th>
                        <th style="width: 50%; border-right: 1px solid #000; padding: 5px; text-align: center;">Description</th>
                        <th style="width: 15%; border-right: 1px solid #000; padding: 5px; text-align: center;">Unit price</th>
                        <th style="width: 10%; border-right: 1px solid #000; padding: 5px; text-align: center;">Qty</th>
                        <th style="width: 15%; padding: 5px; text-align: center;">Total Amt</th>
                    </tr>
                </thead>
                <tbody>
                     @for(int i=0; i<Model.Items.Count; i++)
                     {
                         <tr>
                             <td style="border-right: 1px solid #000; padding: 5px; text-align: center;">@(i+1)</td>
                             <td style="border-right: 1px solid #000; padding: 5px;">@Model.Items[i].Description</td>
                             <td style="border-right: 1px solid #000; padding: 5px; text-align: center;">@Model.Items[i].UnitPrice.ToString("0")</td>
                             <td style="border-right: 1px solid #000; padding: 5px; text-align: center;">@Model.Items[i].Quantity</td>
                             <td style="padding: 5px; text-align: center;">@Model.Items[i].TotalAmount.ToString("0")</td>
                         </tr>
                     }
                </tbody>
            </table>
            
            <!-- Spacer to push total to bottom -->
             <div style="flex-grow: 1; display: flex; width: 100%;">
                 <div style="width: 10%; border-right: 1px solid #000;"></div>
                 <div style="width: 50%; border-right: 1px solid #000;"></div>
                 <div style="width: 15%; border-right: 1px solid #000;"></div>
                 <div style="width: 10%; border-right: 1px solid #000;"></div>
                 <div style="width: 15%;"></div>
             </div>

            <!-- Total Row (Inside the border) -->
            <table style="width: 100%; border-top: 1px solid #000; border-collapse: collapse;">
                <tr>
                    <td style="width: 85%; border-right: 1px solid #000; padding: 5px; font-weight: bold;">Total</td>
                    <td style="width: 15%; padding: 5px; text-align: center; font-weight: bold;">@Model.TotalAmount.ToString("0")</td>
                </tr>
            </table>
        </div>

        <!-- Terms (Fixed at bottom) -->
        <div class="terms-section" style="border-top: 1px solid #000;">
            <strong>Commercial Terms & Conditions</strong>
            <table class="terms-table">
                <tr><td width="30">1</td><td width="150">GST</td><td>18% Extra</td></tr>
                <tr><td>2</td><td>Validity</td><td>This quotation is valid for 30 days from the date of issue.</td></tr>
                <tr><td>3</td><td>Packing & Transport</td><td>Included in the above pricing.</td></tr>
                <tr><td>4</td><td>Insurance</td><td>Extra at actual</td></tr>
                 <tr><td>5</td><td>Delivery</td><td>Within 3-4 weeks</td></tr>
                <tr><td>6</td><td>Payment</td><td>100% against Proforma invoice</td></tr>
                <tr><td>7</td><td>Unloading & Handling Charges</td><td>By client</td></tr>
            </table>
        </div>
    </div>
</body>
</html>
